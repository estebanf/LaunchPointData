"use strict";angular.module("launchPointApiclientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/exceptions",{templateUrl:"views/exceptions.html",controller:"ExceptionsCtrl",controllerAs:"exceptions"}).otherwise({redirectTo:"/"})}]),angular.module("launchPointApiclientApp").controller("MainCtrl",["$http",function(a){var b=this;this.clear=function(){this.search={},this.cases=[],this.pageSize=10,this.page=0,this.count=0,this.totalPages=0,this.pages=[],this.casetracking=[],this.iqtracking=[],this.isotracking=[],this.executionerror=[]},this.clear(),this.back=function(){this.page=this.page-1,this.find()},this.forward=function(){this.page=this.page+1,this.find()},this.nav=function(a){this.page=a,this.find()},this.find=function(){var c={},d=[{active:this.search.active}];this.search.CaseId&&""!==this.search.CaseId&&d.push({caseid:this.search.CaseId}),this.search.ClientId&&""!==this.search.ClientId&&d.push({clientid:this.search.ClientId}),this.search.EnvironmentId&&""!==this.search.EnvironmentId&&d.push({environmentid:this.search.EnvironmentId}),0!==d.length&&(1===d.length?c.where=d[0]:c.where={and:d});var e="?where="+JSON.stringify(c.where);c.limit=this.pageSize,c.skip=this.pageSize*this.page;var f="?filter="+JSON.stringify(c);a.get("/api/launchpointcases"+f).then(function(a){b.cases=a.data,console.log(b.cases)}),a.get("/api/launchpointcases/count"+e).then(function(a){b.count=a.data.count,b.totalPages=Math.ceil(b.count/b.pageSize)})},this.getProcesses=function(c){var d="?filter="+JSON.stringify({where:{and:[{caseid:c.caseid},{clientid:c.clientid},{environmentid:c.environmentid}]}});a.get("/api/casetrackings"+d).then(function(a){b.casetracking=a.data,angular.forEach(b.casetracking,function(a){a.changes=[],angular.forEach(a,function(b,c){if(c.match("changed$")&&b===!0){var d=c.replace("changed",""),e=d+"previous",f=d+"current";a.changes.push({attr:d,previous:a[e],current:a[f]})}})})}),a.get("/api/iqtrackings"+d).then(function(a){b.iqtracking=a.data}),a.get("/api/isotrackings"+d).then(function(a){b.isotracking=a.data}),a.get("/api/executionerrors"+d).then(function(a){b.executionerror=a.data})}}]),angular.module("launchPointApiclientApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("launchPointApiclientApp").controller("ExceptionsCtrl",["$http",function(a){var b=this;this.data=[],this.getData=function(c){a.get("/api/executionerrors/"+c).then(function(a){b.data=a.data.results,console.log(b.data)})},this.resolve=function(c){a.get("/api/executionerrors/recover/"+c.id).then(function(d){console.log(d);var e=b.data.indexOf(c);a.get("/api/executionerrors/"+c.id).then(function(a){var c=a.data;c.resolved?b.data.splice(e,1):b.data[e]=c})})}}]),angular.module("launchPointApiclientApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/exceptions.html",'<div class="row"> <div class="col-xs-2"> <div class="btn-group-vertical" role="group" aria-label="..."> <button type="button" class="btn btn-danger" ng-click="exceptions.getData(\'getActiveTechnical\')">Technical active</button> <button type="button" class="btn btn-danger" ng-click="exceptions.getData(\'getActiveFunctional\')">Functional active</button> <button type="button" class="btn btn-info" ng-click="exceptions.getData(\'getResolvedTechnical\')">Technical resolved</button> <button type="button" class="btn btn-info" ng-click="exceptions.getData(\'getResolvedFunctional\')">Functional resolved</button> </div> </div> <div class="col-xs-10"> <table class="table table-condensed table-hover"> <thead> <tr> <th>id</th> <th>environmentid</th> <th>clientid</th> <th>caseid</th> <th>step</th> <th>failcount</th> <th>validation</th> <th>integration</th> <th>message</th> <th> </tr> <tbody> <tr ng-repeat="item in exceptions.data"> <td>{{item.id}}</td> <td>{{item.environmentid}}</td> <td>{{item.clientid}}</td> <td>{{item.caseid}}</td> <td>{{item.step}}</td> <td>{{item.failcount}}</td> <td>{{item.validation}}</td> <td>{{item.integration}}</td> <td>{{item.message}}</td> <td> <button type="button" class="btn btn-default" ng-if="item.technicalerror && !item.resolved" ng-click="exceptions.resolve(item)"> <i class="fa fa-wrench"></i> </button> </td> </tr> </tbody> </thead> </table> </div> </div>'),a.put("views/main.html",'<div class="row"> <div class="col-xs-3"> <form> <div class="form-group"> <label for="CaseId">ClientId</label> <input type="text" class="form-control" id="CaseId" placeholder="CaseId" ng-model="main.search.CaseId"> </div> <div class="form-group"> <label for="ClientId">ClientId</label> <input type="text" class="form-control" id="ClientId" placeholder="ClientId" ng-model="main.search.ClientId"> </div> <div class="form-group"> <label for="EnvironmentId">ClientId</label> <input type="text" class="form-control" id="EnvironmentId" placeholder="EnvironmentId" ng-model="main.search.EnvironmentId"> </div> <div class="checkbox"> <label> <input type="checkbox" ng-model="main.search.active"> Active </label> </div> <button type="button" class="btn btn-default" ng-click="main.find()">Find</button> <button type="button" class="btn btn-default" ng-click="main.clear()">Clear</button> </form> </div> <div class="col-xs-9"> <div class="row"> <div class="col-xs-12" ng-if="main.cases.length > 0"> <h4>Case tracking</h4> <table class="table table-condensed table-hover" ng-if="main.cases.length > 0"> <thead> <tr> <th>CaseId</th> <th>ClientId</th> <th>EnvironmentId</th> <th>ISO Indicator</th> <th>Score</th> <th>Accident date</th> <th>Funding source</th> <th></th> <th></th> </tr> </thead> <tbody> <tr ng-repeat="lpcase in main.cases"> <td>{{ lpcase.caseid}}</td> <td>{{ lpcase.clientid}}</td> <td>{{ lpcase.environmentid}}</td> <td>{{ lpcase.isoindicator}}</td> <td>{{ lpcase.score}}</td> <td>{{ lpcase.accidentdate}}</td> <td>{{ lpcase.fundingsource}}</td> <td><button type="button" class="btn btn-default"><i class="fa fa-eye" aria-hidden="true"></i></button></td> <td><button type="button" class="btn btn-default" ng-click="main.getProcesses(lpcase)"><i class="fa fa-cogs" aria-hidden="true"></i></button></td> </tr> </tbody> </table> </div> </div> <div class="row" ng-if="main.cases.length > 0"> <div class="col-xs-3"> <h5>Total records: {{main.count}}</h5> </div> <div class="col-xs-1 col-xs-offset-5"> <button type="button" class="btn btn-default" ng-click="main.back()" ng-if="main.page > 0"><i class="fa fa-backward" aria-hidden="true"></i></button> </div> <div class="col-xs-2"> <select class="form-control" ng-options="p as p for p in main.pages track by p" ng-model="main.page" ng-change="main.find()"></select> </div> <div class="col-xs-1"> <button type="button" class="btn btn-default" ng-click="main.forward()" ng-if="main.page < main.totalPages"><i class="fa fa-forward" aria-hidden="true"></i></button> </div> </div> <div class="row" ng-if="main.casetracking.length > 0"> <div class="col-xs-12"> <h4>Case tracking</h4> <table class="table table-condensed table-hover"> <thead> <tr> <th>id</th> <th>Changes</th> <th>Started</th> <th>Completed</th> <th>Rules</th> <th>Matched rules</th> <th>IQ</th> <th>ISO</th> <th>stop</th> <th>closeCase</th> <th>sendToISO</th> <th>sendToIQ</th> <th>IQHold</th> <th>doNothing</th> <th> </tr> </thead> <tbody> <tr ng-repeat="ct in main.casetracking"> <td>{{ct.id}}</td> <td> <p ng-repeat="ch in ct.changes"> {{ch.attr}}: {{ch.previous}} --> {{ch.current}} </p> </td> <td>{{ct.beginprocessingat}}</td> <td>{{ct.finishedprocessingat}}</td> <td>{{ct.ruleexecutedat}}</td> <td>{{ct.discriminationruleid}},{{ct.isoruleid}},{{ct.iqruleid}}</td> <td>{{ct.iq}}</td> <td>{{ct.iso}}</td> <td>{{ct.stop}}</td> <td>{{ct.closecase}}</td> <td>{{ct.sendtoiso}}</td> <td>{{ct.sendtoiq}}</td> <td>{{ct.iqhold}}</td> <td>{{ct.donothing}}</td> <td><button type="button" class="btn btn-default"><i class="fa fa-eye" aria-hidden="true"></i></button></td> </tr> </tbody> </table> </div> </div> <div class="row" ng-if="main.isotracking.length > 0"> <div class="col-xs-12"> <h4>ISO tracking</h4> <table class="table table-condensed table-hover"> <thead> <tr> <th>id</th> <th>isoreceivedat</th> <th>isoquerydcmat</th> <th>isorequestreceivedat</th> <th>isosentat</th> <th>isocompletedat</th> <th>requestid</th> <th> </tr> </thead> <tbody> <tr ng-repeat="it in main.isotracking"> <td>{{it.id}}</td> <td>{{it.isoreceivedat}}</td> <td>{{it.isoquerydcmat}}</td> <td>{{it.isorequestreceivedat}}</td> <td>{{it.isosentat}}</td> <td>{{it.isocompletedat}}</td> <td>{{it.requestid}}</td> <td><button type="button" class="btn btn-default"><i class="fa fa-eye" aria-hidden="true"></i></button></td> </tr> </tbody> </table> </div> </div> <div class="row" ng-if="main.iqtracking.length > 0"> <div class="col-xs-12"> <h4>IQ tracking</h4> <table class="table table-condensed table-hover"> <thead> <tr> <th>id</th> <th>iqreceivedat</th> <th>iqenqueuedat</th> <th>iqdequeuedat</th> <th>iqsentat</th> <th> </tr> </thead> <tbody> <tr ng-repeat="it in main.iqtracking"> <td>{{it.id}}</td> <td>{{it.iqreceivedat}}</td> <td>{{it.iqenqueuedat}}</td> <td>{{it.iqdequeuedat}}</td> <td>{{it.iqsentat}}</td> <td><button type="button" class="btn btn-default"><i class="fa fa-eye" aria-hidden="true"></i></button></td> </tr> </tbody> </table> </div> </div> <div class="row" ng-if="main.executionerror.length > 0"> <div class="col-xs-12"> <h4>Execution error</h4> <table class="table table-condensed table-hover"> <thead> <tr> <th>id</th> <th>failcount</th> <th>technicalerror</th> <th>step</th> <th>resolved</th> <th>integration</th> <th>validation</th> <th>message</th> <th> </tr> </thead> <tbody> <tr ng-repeat="ee in main.executionerror"> <td>{{ee.id}}</td> <td>{{ee.failcount}}</td> <td>{{ee.technicalerror}}</td> <td>{{ee.step}}</td> <td>{{ee.resolved}}</td> <td>{{ee.integration}}</td> <td>{{ee.validation}}</td> <td>{{ee.message}}</td> <td><button type="button" class="btn btn-default"><i class="fa fa-eye" aria-hidden="true"></i></button></td> </tr> </tbody> </table> </div> </div> </div> </div>')}]);